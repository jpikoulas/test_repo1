 <form hideEdit="True" script="common_control.js, drilldown_action_extension.js">
  <label>Resource Usage: Deployment</label>
  <description/>
  <fieldset autoRun="true" submitButton="false">
    <input type="dropdown" searchWhenChanged="true" token="role">
      <label>Role</label>
      <populatingSearch fieldForLabel="label" fieldForValue="search_group">
        | `dmc_get_groups`
        | search search_group="dmc_group_*"
      </populatingSearch>
      <selectFirstChoice>true</selectFirstChoice>
      <showClearButton>false</showClearButton>
    </input>
    <input type="dropdown" searchWhenChanged="true" token="group">
      <label>Group</label>
      <showClearButton>false</showClearButton>
      <search fieldForValue="search_group">
        <query>| `dmc_get_groups_containing_role($role$)` | search search_group!="dmc_group_*"</query>
      </search>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>search_group</fieldForValue>
      <choice value="*">All</choice>
      <selectFirstChoice>true</selectFirstChoice>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <h2>
          <span>Select views: </span>
          <span id="link-switcher-view">
            <a href="#" class="btn-pill active" data-item="all">All</a>
            <a href="#" class="btn-pill" data-item="snapshot">Snapshot</a>
            <a href="#" class="btn-pill" data-item="historical">Historical</a>
          </span>
        </h2>
      </html>
    </panel>
  </row>
  <row>
    <panel rejects="$historical$">
      <title>Snapshots</title>
    </panel>
  </row>
  <row>
    <panel rejects="$historical$">
      <title>Resource Usage by Instance</title>
      <table>
        <title>$countInstance$ instances</title>
        <search>
          <query>
| rest splunk_server_group=$role$ splunk_server_group=$group$ /services/server/status/resource-usage/hostwide
| eval cpu_count = if(isnull(cpu_count), "N/A", cpu_count)
| eval cpu_usage = cpu_system_pct + cpu_user_pct
| eval mem_used_pct = round(mem_used / mem * 100 , 2)
| eval mem_used = round(mem_used, 0)
| eval mem = round(mem, 0)
| fields splunk_server, cpu_count, cpu_usage, mem, mem_used, mem_used_pct
| sort - cpu_usage, -mem_used
| rename splunk_server AS Instance, cpu_count AS "CPU Cores", cpu_usage AS "CPU Usage (%)", mem AS "Physical Memory Capacity (MB)", mem_used AS "Physical Memory Usage (MB)", mem_used_pct AS "Physical Memory Usage (%)"
          </query>
          <done>
            <set token="countInstance">$job.resultCount$</set>
          </done>
        </search>
        <option name="refresh.auto.interval">60</option>
        <option name="refresh.time.visible">false</option>
        <drilldown>
          <condition field="Instance">
            <link target="_blank">
              <![CDATA[resource_usage_instance?form.splunk_server=$click.value2$]]>
            </link>
          </condition>
          <condition field="*"></condition>
        </drilldown>
      </table>
      <html>
        <p>Click on instance name for more details.</p>
      </html>
    </panel>
  </row>
  <row>
    <panel rejects="$snapshot$">
      <title>Historical Charts</title>
      <input type="time" searchWhenChanged="true" token="time">
        <label>Time Range:</label>
        <default>
          <earliestTime>-4h@m</earliestTime>
          <latestTime>now</latestTime>
        </default>
      </input>
      <input type="checkbox" searchWhenChanged="true" token="split_by_host">
        <label></label>
        <choice>Split by host</choice>
      </input>
    </panel>
  </row>
  <row>
    <panel rejects="$snapshot$">
      <title>$countCPUFuncLabel$ CPU Usage</title>
      <input type="dropdown" token="countCPUFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="countCPUFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="countCPUFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="countCPUFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="countCPUFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="countCPUFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="countCPUFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart rejects="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval total_cpu_usage = 'data.cpu_system_pct' + 'data.cpu_user_pct' 
| eval server = host 
| `dmc_set_bin_for_timechart`
| stats $countCPUFunc$(total_cpu_usage) as cpu_usage by server _time
| `dmc_cpu_usage_rangemap_and_timechart`
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Instance count</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "100%+": 0x956D95, "abnormal":0xC4C4C0}</option>
        <drilldown>
          <condition match="isnotnull('row._span')">
            <set token="drilldown_cpu_usage">true</set>
            <set token="drilldown_cpu_usage_span">$row._span$</set>
            <set token="drilldown_cpu_usage_earliest">$earliest$</set>
            <eval token="drilldown_cpu_usage_earliest_label">strftime(earliest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_cpu_usage_latest">$latest$</set>
            <eval token="drilldown_cpu_usage_latest_label">strftime(latest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_cpu_usage_metric">$click.name2$</set>
            <set token="drilldown_cpu_usage_count">$click.value2$</set>
          </condition>
          <condition />
        </drilldown>
      </chart>
      <table depends="$drilldown_cpu_usage$" rejects="$split_by_host$" id="drilldown_cpu_usage">
        <title>Time range: $drilldown_cpu_usage_earliest_label$ ~ $drilldown_cpu_usage_latest_label$. Metric: $countCPUFunc$ CPU usage range: $drilldown_cpu_usage_metric$. ($drilldown_cpu_usage_count$ instances)</title>
        <search>
          <query>`dmc_drilldown_resource_usage_deployment_cpu_usage("$role$", "$group$", $drilldown_cpu_usage_span$, $countCPUFunc$, $drilldown_cpu_usage_metric$)`</query>
          <earliest>$drilldown_cpu_usage_earliest$</earliest>
          <latest>$drilldown_cpu_usage_latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
      <html depends="$drilldown_cpu_usage$" rejects="$split_by_host$">
        <a data-unset-token="drilldown_cpu_usage">Close this drilldown table</a>
      </html>
      <chart depends="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval total_cpu_usage = 'data.cpu_system_pct' + 'data.cpu_user_pct'
|`dmc_timechart_for_metrics_log` partial=f limit=25 $countCPUFunc$(total_cpu_usage) AS cpu_usage by host
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">CPU Usage (%)</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "100%+": 0x956D95, "abnormal":0xC4C4C0}</option>
      </chart>
      <html rejects="$split_by_host$">
        <p>Count of instances grouped by $countCPUFuncLabel$ machine-wide CPU usage over time.</p>
      </html>
      <html depends="$split_by_host$">
        <p>$countCPUFuncLabel$ machine-wide CPU usage over time by instance.</p>
      </html>
    </panel>
    <panel rejects="$snapshot$">
      <title>Deployment-Wide $avgCPUFuncLabel$ CPU Usage</title>
      <input type="dropdown" token="avgCPUFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="avgCPUFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="avgCPUFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="avgCPUFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="avgCPUFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="avgCPUFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="avgCPUFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart>
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval total_cpu_usage = ('data.cpu_system_pct' + 'data.cpu_user_pct')
| eval server = host
| `dmc_set_bin`
| stats latest(total_cpu_usage) as dedup_total_cpu_usage by server _time
| `dmc_timechart` $avgCPUFunc$(dedup_total_cpu_usage) as cpu_usage
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">CPU Usage (%)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY.maximumNumber">100</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel rejects="$snapshot$">
      <title>$countMemFuncLabel$ Physical Memory Usage</title>
      <input type="dropdown" token="countMemFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="countMemFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="countMemFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="avgCPUFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="avgCPUFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="avgCPUFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="avgCPUFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart rejects="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval pct_mem_used = 'data.mem_used' / 'data.mem' 
| eval server = host 
| `dmc_set_bin_for_timechart`
| stats $countMemFunc$(pct_mem_used) as pct_mem_used by server _time
| `dmc_memory_usage_rangemap_and_timechart`
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Instance count</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "abnormal":0xC4C4C0}</option>
        <drilldown>
          <condition match="isnotnull('row._span')">
            <set token="drilldown_memory_usage">true</set>
            <set token="drilldown_memory_usage_span">$row._span$</set>
            <set token="drilldown_memory_usage_earliest">$earliest$</set>
            <eval token="drilldown_memory_usage_earliest_label">strftime(earliest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_memory_usage_latest">$latest$</set>
            <eval token="drilldown_memory_usage_latest_label">strftime(latest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_memory_usage_metric">$click.name2$</set>
            <set token="drilldown_memory_usage_count">$click.value2$</set>
          </condition>
          <condition />
        </drilldown>
      </chart>
      <table depends="$drilldown_memory_usage$" rejects="$split_by_host$" id="drilldown_memory_usage">
        <title>Time range: $drilldown_memory_usage_earliest_label$ ~ $drilldown_memory_usage_latest_label$. Metric: $countMemFunc$ memory usage range: $drilldown_memory_usage_metric$. ($drilldown_memory_usage_count$ instances)</title>
        <search>
          <query>`dmc_drilldown_resource_usage_deployment_memory_usage("$role$", "$group$", $drilldown_memory_usage_span$, $countMemFunc$, $drilldown_memory_usage_metric$)`</query>
          <earliest>$drilldown_memory_usage_earliest$</earliest>
          <latest>$drilldown_memory_usage_latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
      <html depends="$drilldown_memory_usage$" rejects="$split_by_host$">
        <a data-unset-token="drilldown_memory_usage">Close this drilldown table</a>
      </html>
      <chart depends="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval pct_mem_used = 'data.mem_used' / 'data.mem' * 100
| eval server = host
| `dmc_set_bin_for_timechart`
| `dmc_timechart_for_metrics_log` partial=f limit=25 $countMemFunc$(pct_mem_used) AS pct_mem_used by server
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">% disk usage</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "abnormal":0xC4C4C0}</option>
      </chart>
      <html rejects="$split_by_host$">
        <p>Count of instances grouped by $countMemFuncLabel$ machine-wide physical memory usage over time.</p>
      </html>
      <html depends="$split_by_host$">
        <p>$countMemFuncLabel$ machine-wide physical memory usage over time by instance.</p>
      </html>
    </panel>
    <panel rejects="$snapshot$">
      <title>Deployment-Wide $avgMemFuncLabel$ Physical Memory Usage</title>
      <input type="dropdown" token="avgMemFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="avgMemFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="avgMemFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="avgMemFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="avgMemFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="avgMemFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="avgMemFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart>
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ source=*resource_usage.log sourcetype=splunk_resource_usage component=Hostwide
| eval pct_mem_usage = 'data.mem_used' / 'data.mem' * 100 
| eval server = host 
| `dmc_set_bin`
| stats latest(pct_mem_usage) as dedup_pct_mem_usage by server _time 
| `dmc_timechart` $avgMemFunc$(dedup_pct_mem_usage) as pct_mem_usage
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Memory Usage (%)</option>
        <option name="charting.axisY.maximumNumber">100</option>
        <option name="charting.axisY.minimumNumber">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel rejects="$snapshot$">
      <title>$countDiskFuncLabel$ Disk Usage</title>
      <input type="dropdown" token="countDiskFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="countDiskFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="countDiskFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="countDiskFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="countDiskFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="countDiskFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="countDiskFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart rejects="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions
| eval mount_point = 'data.mount_point'
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free')
| eval pct_disk_usage = 1 - free / 'data.capacity'
| `dmc_set_bin_for_timechart_for_disk_usage`
| eval server_mount_point = host.":".mount_point
| stats $countDiskFunc$(pct_disk_usage) as pct_disk_usage by server_mount_point _time
| `dmc_disk_usage_rangemap_and_timechart`
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "abnormal":0xC4C4C0}</option>
        <option name="charting.axisTitleY.text">Instance count</option>
        <drilldown>
          <condition match="isnotnull('row._span')">
            <set token="drilldown_disk_usage">true</set>
            <set token="drilldown_disk_usage_span">$row._span$</set>
            <set token="drilldown_disk_usage_earliest">$earliest$</set>
            <eval token="drilldown_disk_usage_earliest_label">strftime(earliest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_disk_usage_latest">$latest$</set>
            <eval token="drilldown_disk_usage_latest_label">strftime(latest, "%m/%d/%Y %H:%M:%S")</eval>
            <set token="drilldown_disk_usage_metric">$click.name2$</set>
            <set token="drilldown_disk_usage_count">$click.value2$</set>
          </condition>
          <condition />
        </drilldown>
      </chart>
      <table depends="$drilldown_disk_usage$" rejects="$split_by_host$" id="drilldown_disk_usage">
        <title>Time range: $drilldown_disk_usage_earliest_label$ ~ $drilldown_disk_usage_latest_label$. Metric: $countDiskFunc$ disk usage range: $drilldown_disk_usage_metric$. ($drilldown_disk_usage_count$ instances)</title>
        <search>
          <query>`dmc_drilldown_resource_usage_deployment_disk_usage("$role$", "$group$", $drilldown_disk_usage_span$, $countDiskFunc$, $drilldown_disk_usage_metric$)`</query>
          <earliest>$drilldown_disk_usage_earliest$</earliest>
          <latest>$drilldown_disk_usage_latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
      <html depends="$drilldown_disk_usage$" rejects="$split_by_host$">
        <a data-unset-token="drilldown_disk_usage">Close this drilldown table</a>
      </html>
      <chart depends="$split_by_host$">
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions
| eval mount_point = 'data.mount_point'
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free')
| eval pct_disk_usage = (1 - free / 'data.capacity') * 100
| `dmc_set_bin_for_timechart_for_disk_usage`
| eval server_mount_point = host.":".mount_point
| `dmc_timechart_for_metrics_log` partial=f limit=25 $countDiskFunc$(pct_disk_usage) AS pct_disk_usage by server_mount_point
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.fieldColors">{"80-100%": 0xD85D3C, "60-80%": 0xF7902B, "0-60%":0x9AC23C, "abnormal":0xC4C4C0}</option>
        <option name="charting.axisTitleY.text">% disk usage</option>
      </chart>
      <html rejects="$split_by_host$">
        <p>Count of instances grouped by $countDiskFuncLabel$ disk usage over time. This metric takes into account all partitions in use by each instance.</p>
      </html>
      <html depends="$split_by_host$">
        <p>$countDiskFuncLabel$ disk usage over time by instance. This metric takes into account all partitions in use by each instance.</p>
      </html>
    </panel>
    <panel rejects="$snapshot$">
      <title>Deployment-Wide $avgDiskFuncLabel$ Disk Usage</title>
      <input type="dropdown" token="avgDiskFunc" searchWhenChanged="true">
        <label>Aggregation</label>
        <showClearButton>false</showClearButton>
        <default>Median</default>
        <choice value="Median">Median</choice>
        <choice value="Max">Maximum</choice>
        <choice value="Min">Minimum</choice>
        <choice value="Perc90">90th Percentile</choice>
        <choice value="First">Sampled</choice>
        <change>
          <condition value="Median">
            <set token="avgDiskFuncLabel">Median</set>
          </condition>
          <condition value="Perc90">
            <set token="avgDiskFuncLabel">90th Percentile</set>
          </condition>
          <condition value="Avg">
            <set token="avgDiskFuncLabel">Average</set>
          </condition>
          <condition value="Max">
            <set token="avgDiskFuncLabel">Maximum</set>
          </condition>
          <condition value="Min">
            <set token="avgDiskFuncLabel">Minimum</set>
          </condition>
          <condition value="First">
            <set token="avgDiskFuncLabel">Sampled</set>
          </condition>
        </change>
      </input>
      <chart>
        <search>
          <query>
`dmc_set_index_introspection` search_group=$role$ search_group=$group$ sourcetype=splunk_disk_objects component=Partitions
| eval server = host 
| eval mount_point = 'data.mount_point'
| eval free = if(isnotnull('data.available'), 'data.available', 'data.free')
| eval pct_disk_usage = (1 - free / 'data.capacity') * 100
| `dmc_set_bin_for_disk_usage`
| stats latest(pct_disk_usage) as dedup_pct_disk_usage by server mount_point _time 
| `dmc_timechart_for_disk_usage` $avgDiskFunc$(dedup_pct_disk_usage) as pct_disk_usage
          </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Disk Usage (%)</option>
        <option name="charting.axisY.maximumNumber">100</option>
        <option name="charting.axisY.minimumNumber">0</option>
      </chart>
      <html>
        <p>This metric takes into account all partitions in use by each Splunk Enterprise instance.</p>
      </html>
    </panel>
  </row>
</form>
